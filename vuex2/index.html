<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<title>Vuex</title>
</head>
<body >
	<script src='./js/vue2.1.js'></script>
	<script src='./js/vuex.min.js'></script>
	<div id="app">
	</div>
	<script>
		// 创建一个 Counter 组件
		const Counter = {
		  template: `<div>{{ amount }}</div>`,
		  computed: {
		    count () {
		      return this.$store.state.count
		    },
		    amount() {
		    	return this.$store.state.amount;
		    }
		  }
		}
		const store = new Vuex.Store({
		  // state数据
		  state: {
		    todos: [
		      { id: 1, text: '...1', done: true },
		      { id: 2, text: '...2', done: false },
		      { id: 3, text: '...3', done: true }
		    ],
		    count:1,
		    amount:20
		  },
		  // store的计算属性
		  getters: {
		    doneTodos: state => {
		      return state.todos.filter(todo => todo.done)
		    }
		  },
		  //变化
		  mutations: {
		    increment (state,payload) {
		      console.log('触发一次....');
		      console.log(payload);
		      state.count+=payload.num;
		    },
		    incrementAsync(state,payload){
		    	console.log('触发incrementAsync...');
		    	console.log(state);
		    	state.amount+=100;
		    }
		  },
		  actions: {
	    	increment2 ({commit:commit}) {
	    	 console.log('actions--increment...');
	    	 setTimeout(() => {
	    	 	commit('increment',{num:30});
	    	 	console.log('2秒时间到.....');
	    	 },2000);
	      	 
	        },
	        do2({commit}){
	        	console.log('do2....');
	        	commit('incrementAsync',{amount:100});
	        }
	  	 }
		});
		 
		const app = new Vue({
		  el: '#app',
		  methods: {
		  	add: function(){
		  		console.log(this.$store);
		  		console.log(this.$store.state);
		  		console.log(this.$store.getters);
		  		//this.$store.commit('increment',{num:20,num2:11});
		  		// this.$store.commit({
		  		// 	num:30,
		  		// 	num2:11,
		  		// 	type:'increment'
		  		// });
		  		//触发一个行为
		  		//this.$store.dispatch('increment2');
		  		this.$store.dispatch('do2');
		  	}
		  },
		  // 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件
		  store:store,
		  components: { Counter },
		  template: `
		    <div class="app">
		      <counter></counter>
		      <button @click="add()">加1</button>
		    </div>
		  `
		})
	</script>
</body>
</html>